builddir = @builddir@
srcdir = @srcdir@
top_srcdir = @top_srcdir@
VPATH = @srcdir@

PKGNAME = @PKGNAME@
PKGVERSION = @PKGVERSION@

include @top_srcdir@/mk/gnu.bsdvars.mk

pkglibdir = @pkglibdir@
pkgdefaultlibdir = @pkgdefaultlibdir@
pkglibexecdir = @pkglibexecdir@
pkgdocdir = @pkgdocdir@
destpkglibdir = @destpkglibdir@
destpkglibexecdir = @destpkglibexecdir@
destpkgdocdir = @destpkgdocdir@

toolsdir = @top_srcdir@/tools

.SUFFIXES: .html .xml .css
DOCS = index # guide reference debug status
TARGETS += ${foreach DOC,${DOCS},${DOC}.html}
RESOURCES = documentation.css

XSLTPROC = /usr/bin/xsltproc --novalid 
HTMLPP = ~/bin/HTMLPP-0.7/htmlpp
HTMLWRAP = ~/bin/HTMLPP-0.7/htmlwrap
TIDY = /usr/bin/tidy -q
URLINSTALL = ~/bin/URL-Utils-0.5/url-install


PARAMS += --stringparam XBL_SCRIPT_URL ${pkglibexecdir}/XBLUI.js
PARAMS += --stringparam pkgdefaultlibdir ${pkgdefaultlibdir}

BUILD_TARGETS += ${foreach DOC,${DOCS},${builddir}/${DOC}.html}

all: build

build: ${BUILD_TARGETS} ${RESOURCES}

clean:
	-rm ${TARGETS}
	-rm wrapper.html

install: ${BUILD_TARGETS} ${RESOURCES}
	for FILE in ${TARGETS}; do \
		${URLINSTALL} $${FILE} ${destpkgdocdir}/$${FILE}; \
		gzip -c $${FILE} | ${URLINSTALL} - ${destpkgdocdir}/$${FILE}.gz; \
	done;
	for FILE in ${RESOURCES}; do \
		${URLINSTALL} ${srcdir}/$${FILE} ${destpkgdocdir}/$${FILE}; \
		gzip -c ${srcdir}/$${FILE} | ${URLINSTALL} - ${destpkgdocdir}/$${FILE}.gz; \
	done;

${BUILD_TARGETS}: ${builddir}/%.html : ${srcdir}/%.html ${builddir}/wrapper.html
	${HTMLPP} ${PARAMS} ${.IMPSRC} |\
	${HTMLWRAP} --wrapper wrapper.html - > ${.TARGET}

${builddir}/wrapper.html: ${srcdir}/wrapper.html
	${HTMLPP} ${PARAMS} ${.IMPSRC} > ${.TARGET}
